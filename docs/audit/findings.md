# Критичные дефекты и риски

## P0 - Критичные дефекты (блокируют работу)

### 1. Сгенерированный SDK отсутствует
**Файлы**: `frontend/src/shared/api/sdk/generated/`
**Проблема**: 11 ESLint ошибок из-за отсутствующих импортов
```typescript
// ❌ ОШИБКА
import { BlockTypeEnum } from '../../shared/api/sdk/generated/models/BlockTypeEnum';
// Cannot find module '../../shared/api/sdk/generated/models/BlockTypeEnum'
```

**Влияние**: 
- Frontend не компилируется
- TypeScript ошибки
- Невозможно использовать типизированные API

**Решение**:
```bash
# Сгенерировать SDK из OpenAPI схемы
npx @openapitools/openapi-generator-cli generate \
  -i schema.yaml \
  -g typescript-axios \
  -o src/shared/api/sdk/generated
```

**Время исправления**: 30 минут

### 2. Синтаксические ошибки в API файлах
**Файлы**: 
- `backend/api/urls.py` (строки 88-89, 129)
- `frontend/src/features/databases/api.ts` (строки 57, 88)
- `frontend/src/features/search/api.ts` (строки 156, 204)

**Проблема**: Неправильный синтаксис Python/TypeScript
```python
# ❌ ОШИБКА в backend/api/urls.py
notifications_router.register(
    r"settings",
    ,  # ← Пустой параметр
    basename="notificationsettings",
)
```

```typescript
// ❌ ОШИБКА в frontend/src/features/databases/api.ts
deleteRecord: (recordId: string) => 
  api.delete(`/records/${recordId}/`)  // ← Нет запятой
```

**Влияние**: 
- Backend не запускается
- Frontend не компилируется
- API недоступен

**Решение**: Исправить синтаксис
**Время исправления**: 15 минут

### 3. API методы полностью заглушены
**Файлы**: 
- `frontend/src/features/notes/api.ts` (все методы)
- `frontend/src/features/comments/api/index.ts` (все методы)
- `frontend/src/features/notifications/api.ts` (все методы)

**Проблема**: Основной функционал не работает
```typescript
// ❌ ЗАГЛУШКА
export const notesApi = {
  getPage: async (id: string) => {
    return {
      id,
      title: 'Заглушка',  // ← Не работает
      content: '',
    };
  },
};
```

**Влияние**: 
- Заметки не работают
- Комментарии не работают
- Уведомления не работают
- 30% функционала недоступно

**Решение**: Реализовать реальные API вызовы
**Время исправления**: 2-3 дня

## P1 - Важные дефекты (влияют на UX)

### 4. Падающие тесты (29% от общего числа)
**Файлы**: 
- `frontend/src/features/comments/ui/CommentsPanel.test.tsx` (6 тестов)
- `frontend/src/widgets/TaskBoard/PageDrawer.test.tsx` (2 теста)
- `frontend/src/features/databases/ui/DatabaseTable.test.tsx` (20 тестов)

**Проблема**: Тесты не проходят из-за заглушек
```typescript
// ❌ ТЕСТ ПАДАЕТ
expect(screen.getByText('Загрузка комментариев...')).toBeInTheDocument();
// Компонент всегда показывает пустое состояние
```

**Влияние**: 
- Нет уверенности в качестве кода
- CI/CD не работает
- Регрессии не обнаруживаются

**Решение**: Исправить тесты и заглушки
**Время исправления**: 1 день

### 5. Отсутствует интернационализация
**Проблема**: Все тексты захардкожены на русском
```typescript
// ❌ ЗАХАРДКОЖЕНО
<h1>Добро пожаловать!</h1>
<p>Выберите действие для начала работы</p>
```

**Влияние**: 
- Невозможно локализовать
- Плохой UX для международных пользователей
- Сложно поддерживать

**Решение**: Добавить react-i18next
**Время исправления**: 1-2 дня

### 6. Проблемы с доступностью
**Проблема**: Неполное покрытие ARIA атрибутов
```typescript
// ❌ НЕТ aria-label
<button className="p-2 text-gray-400 hover:text-gray-600">
  <FunnelIcon className="w-5 h-5" />
</button>
```

**Влияние**: 
- Плохой UX для пользователей с ограниченными возможностями
- Несоответствие стандартам доступности

**Решение**: Добавить ARIA атрибуты
**Время исправления**: 1 день

### 7. Неправильная версия Python
**Проблема**: Python 3.7.7 < 3.8 (требуется)
**Влияние**: 
- Потенциальные проблемы совместимости
- Невозможно использовать новые возможности

**Решение**: Обновить до Python 3.8+
**Время исправления**: 30 минут

## P2 - Менее критичные дефекты

### 8. Отсутствует .env.example
**Проблема**: Нет примера конфигурации
**Влияние**: 
- Сложно настроить проект
- Ошибки при развертывании

**Решение**: Создать .env.example
**Время исправления**: 15 минут

### 9. Отсутствует .nvmrc
**Проблема**: Нет указания версии Node.js
**Влияние**: 
- Проблемы совместимости
- Сложно воспроизвести окружение

**Решение**: Создать .nvmrc
**Время исправления**: 5 минут

### 10. Множество console.log
**Проблема**: 20+ console.log в продакшен коде
```typescript
// ❌ DEBUG КОД
console.log('Открыть базу данных:', { databaseId, viewId });
console.log('Drawer открыт');
```

**Влияние**: 
- Засорение консоли
- Потенциальные утечки данных

**Решение**: Заменить на структурированное логирование
**Время исправления**: 2 часа

## Быстрые победы (Quick Wins)

### 1. Исправить синтаксические ошибки (15 минут)
```bash
# Backend
# Исправить backend/api/urls.py

# Frontend  
# Исправить frontend/src/features/databases/api.ts
# Исправить frontend/src/features/search/api.ts
```

### 2. Создать недостающие файлы (20 минут)
```bash
# .env.example
cp .env .env.example

# .nvmrc
echo "18" > .nvmrc

# .python-version
echo "3.8" > .python-version
```

### 3. Сгенерировать SDK (30 минут)
```bash
npx @openapitools/openapi-generator-cli generate \
  -i schema.yaml \
  -g typescript-axios \
  -o src/shared/api/sdk/generated
```

### 4. Обновить Python (30 минут)
```bash
brew install python@3.8
pyenv local 3.8.0
```

## Потенциальные ловушки при рефакторинге

### 1. Зависимости между заглушками
**Проблема**: Заглушки могут быть связаны между собой
**Риск**: Исправление одной заглушки может сломать другую
**Решение**: Тестировать после каждого изменения

### 2. Тесты зависят от заглушек
**Проблема**: Тесты написаны под заглушки
**Риск**: Реализация API может сломать тесты
**Решение**: Переписать тесты под реальные API

### 3. Типы могут измениться
**Проблема**: Сгенерированный SDK может иметь другие типы
**Риск**: Конфликты типов
**Решение**: Обновить типы после генерации SDK

### 4. Порядок исправления важен
**Проблема**: Некоторые исправления зависят от других
**Риск**: Неправильный порядок может усложнить процесс
**Решение**: 
1. Сначала синтаксические ошибки
2. Потом SDK
3. Потом API заглушки
4. Потом тесты

## Приоритеты исправления

### Неделя 1 (Критичные)
- [ ] Исправить синтаксические ошибки
- [ ] Сгенерировать SDK
- [ ] Обновить Python
- [ ] Создать .env.example

### Неделя 2 (Важные)
- [ ] Реализовать API заглушки
- [ ] Исправить падающие тесты
- [ ] Добавить i18n
- [ ] Улучшить accessibility

### Неделя 3 (Улучшения)
- [ ] Заменить console.log
- [ ] Добавить E2E тесты
- [ ] Улучшить документацию
- [ ] Оптимизировать производительность

## Метрики рисков

| Тип риска | Количество | Критичность | Время исправления |
|-----------|------------|-------------|-------------------|
| Синтаксические ошибки | 5 | P0 | 15 минут |
| Отсутствующий SDK | 1 | P0 | 30 минут |
| API заглушки | 3 модуля | P0 | 2-3 дня |
| Падающие тесты | 28 тестов | P1 | 1 день |
| Отсутствие i18n | 1 | P1 | 1-2 дня |
| Проблемы a11y | 10+ | P1 | 1 день |
| Console.log | 20+ | P2 | 2 часа |

**Общий риск**: ВЫСОКИЙ (много критичных проблем)
**Время до рабочего состояния**: 1-2 недели
**Время до продакшен готовности**: 3-4 недели
